<%-include("../layout/head")%>
<%-include("../layout/header")%>
<%-include("../layout/sidebar")%>
		
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">			
		<div class="row">
			<ol class="breadcrumb mt-3">
                <li><a href="/admin"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
                <li><a href="/admin/products">Quản lý sản phẩm</a></li>
				<li class="active">Sản phẩm: <%= product.name %></li>
			</ol>
		</div><div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Sản phẩm: <%= product.name %></h1>
			</div>
        </div><% if (typeof errors !== 'undefined' && errors.length > 0) { %>
            <div class="alert alert-danger">
                <ul>
                    <% errors.forEach(error => { %>
                        <li><%= Array.isArray(error) ? error[0].msg : error.msg %></li> 
                    <% }) %>
                </ul>
            </div>
        <% } %>
        
        <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <form role="form" method="post" action="/admin/products/update/<%= product._id %>" enctype="multipart/form-data">
                            <div class="col-md-6">
                                <input type="hidden" name="status" value="active">
                                <div class="form-group">
                                    <label>Tên sản phẩm</label>
                                    <input type="text" name="name" required class="form-control" value="<%= product.name %>"  placeholder="">
                                </div>
                                                                
                                <div class="form-group">
                                    <label>Giá sản phẩm</label>
                                    <input type="number" name="price" required class="form-control" value="<%= product.price %>">
                                </div>
                                <div class="form-group">
                                    <label>Ảnh sản phẩm</label>
                                    <input type="file" name="image" onchange="previewImage(this);">
                                    <br>
                                    <div class="product-preview">
                                        <img id="image-preview" src="/uploads/products/<%=product.image%>" style="max-width: 100px;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Phụ kiện</label>
                                    <input type="text" name="accessories" required class="form-control" value="<%= product.accessories %>">
                                </div>
                                <div class="form-group">
                                    <label>Khuyến mãi</label>
                                    <input type="text" name="promotion" required class="form-control" value="<%= product.promotion %>">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Danh mục</label>
                                    <select name="category_id" class="form-control">
                                        <option value="">-- Chọn danh mục --</option>
                                        <% 
                                            categories.forEach(category => { 
                                            const isSelected = product.category_id.toString() === category._id.toString(); 
                                        %>
                                            <option value="<%= category._id %>" <%= isSelected ? 'selected' : '' %>>
                                                <%= category.name %>
                                            </option>
                                        <% }); %>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Tình trạng</label>
                                    <select name="is_stock" class="form-control">
                                        <option value="1" <%= product.is_stock ? 'selected' : '' %>>Còn hàng</option>
                                        <option value="0" <%= !product.is_stock ? 'selected' : '' %>>Hết hàng</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Sản phẩm nổi bật</label>
                                    <div class="checkbox">
                                        <label>
                                            <input name="is_featured" type="checkbox" <%= product.is_featured ? 'checked' : '' %>>Nổi bật
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                        <label>Mô tả sản phẩm</label>
                                        <textarea name="details" required class="form-control" rows="3"><%= product.details %></textarea>
                                    </div>
                                <button type="submit" name="sbm" class="btn btn-primary">Cập nhật</button>
                                <button type="reset" class="btn btn-default">Làm mới</button>
                            </div>
                        </form>
                        </div>
                    </div>
                </div></div></div>	<script>
        // Hàm xem trước ảnh (dùng chung cho cả 2 form)
        function previewImage(input) {
            const preview = document.getElementById('image-preview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
<%-include("../layout/footer")%>